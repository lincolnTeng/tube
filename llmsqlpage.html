<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM SQL Tool</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"/>
    <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
    <style>
        body { padding-top: 2rem; }
        main.container { max-width: 95%; }
        .main-layout { display: grid; grid-template-columns: 300px 1fr; gap: 2rem; }
        .nav-listbox { height: 400px; }
        .child-option { padding-left: 2rem !important; }
        #table-display-area .gridjs-wrapper { border: none; box-shadow: none; }
        .import-target-bar {
            padding: 0.75rem;
            margin-bottom: 1rem;
            border-radius: var(--pico-border-radius);
            background-color: var(--pico-muted-background-color);
            border: 1px solid var(--pico-muted-border-color);
        }
    </style>
</head>
<body>
    <main class="container">
        <header>
            <h1 style="text-align: center;">LLM SQL Tool</h1>
        </header>

        <!-- Section 1: Data Exploration (New Layout) -->
        <article class="main-layout">
            <!-- Left: Unified Tree Navigation -->
            <div>
                <label for="nav-select"><strong>1. Select Data Source</strong></label>
                <select id="nav-select" class="nav-listbox" size="2">
                    <!-- Dynamic content will be loaded here -->
                </select>
                <button id="create-tableset-btn" style="width: 100%; margin-top: 1rem;">Create TableSet</button>
            </div>
            <!-- Right: Table Content Display -->
            <div id="table-display-area">
                <label><strong>2. View Table Content</strong></label>
                <!-- Grid.js will render here -->
            </div>
        </article>

        <!-- Section 2: Operations (Query & Import) -->
        <section class="operations-tabs">
            <nav>
                <ul>
                    <li><a class="tab-button active" data-target="query-tab">Query with LLM</a></li>
                    <li><a class="tab-button" data-target="import-tab">Import Data</a></li>
                </ul>
            </nav>
            <div class="tab-content">
                <article id="query-tab" class="active">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <div>
                            <label for="llm-prompt"><strong>1. Write your request</strong></label>
                            <textarea id="llm-prompt" placeholder="e.g., 'Show me the top 3 customers from the USA'" style="height: 150px;"></textarea>
                            <button id="generate-sql-btn" style="width: 100%; margin-top: 1rem;">Generate SQL</button>
                        </div>
                        <div>
                            <label for="sql-output"><strong>2. Review generated SQL</strong></label>
                            <textarea id="sql-output" readonly placeholder="SQL will appear here..." style="height: 150px;"></textarea>
                            <button id="execute-sql-btn" class="contrast" disabled style="width: 100%; margin-top: 1rem;">Execute SQL</button>
                        </div>
                    </div>
                </article>

                <article id="import-tab">
                    <div class="import-target-bar">
                        Importing to TableSet: <strong id="import-target-display">None Selected</strong>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <div>
                            <label for="r2-file-select"><strong>1. Select file from R2 or Upload</strong></label>
                            <select id="r2-file-select" size="8"></select>
                            <label for="file-upload" style="margin-top: 1rem;">Upload a new file (CSV, JSON)</label>
                            <input type="file" id="file-upload">
                        </div>
                        <div>
                            <label for="file-preview"><strong>2. Preview File & Analyze</strong></label>
                            <textarea id="file-preview" readonly placeholder="File preview will show here..." style="height: 200px;"></textarea>
                            <button id="analyze-file-btn" style="width: 100%; margin-top: 1rem;">Analyze File</button>
                            <div id="schema-suggestion-area" style="margin-top: 1rem;"></div> 
                            <button id="import-btn" class="contrast" style="width: 100%; margin-top: 1rem; display: none;">Confirm & Import</button>
                        </div>
                    </div>
                </article>
            </div>
        </section>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
    <script src="main.js"></script> 
</body>
</html>
